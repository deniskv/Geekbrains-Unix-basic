# Домашняя работа 8
## Ход работы

**Настроить сетевой фильтр, чтобы из внешней сети можно было обратиться только к сервисам http и ssh (80 и 443).**

разрешим подключение к портам

>sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
>sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT

**Запросы, идущие на порт 8080, перенаправлять на порт 80.**

перенаправим Запрсы с 8080 на 80

>sudo iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80

и убедимся, что перенаправление работает

>sudo iptables -t nat -L

и запретим все остальное 

>sudo iptables -A INPUT -j DROP

**Настроить доступ по ssh только для вашего IP-адреса (или из всей сети вашего провайдера).**

>iptables -A INPUT -p tcp -s 185.165.160.152 --dport 22 -j ACCEPT

*** Создать нового пользователя, сгенерировать для него новые сертификаты. Настроить доступ на сервер вновь созданного пользователя с использованием сертификатов. Подключиться с помощью putty или ssh без ввода пароля (используя только сертификат).**

Для начала сгенерируем ключ на машине пользователя

>ssh-keygen

Ничего не меняем, ключи будут в ~/.ssh

На сервере

добавим пользователя 

>sudo useradd newuser

Далее можно решить двумя способами. Если делаем все для себя: ключ генерировали на своей машине и будем ходить на сервер со своей машины, тогда:

>ssh-copy-id newuser@192.168.0.5

Подтверждаем диалог от системы, вводим пароль для newuser

Второй способ: если делаем для кого-то, кто предоставил нам публичный ключ или если первый способ не сработал

>cat ~/.ssh/id_rsa.pub | ssh newuser@192.168.0.5 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"

То есть мы вручную выполняем то, что делается автоматически в первом случае

И последний этап:

Отключим авториз по паролю

>sudo vi /etc/ssh/sshd_config

далее выставляем

```PasswordAuthentication no```

сохраняем и перезапускаем службу

>sudo service ssh restart